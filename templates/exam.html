<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{.TestMetadata.TestName}}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .exam-header { 
        background: #fff; 
        border-radius: 1.5rem; 
        box-shadow: 0 2px 16px #e0e7ef66; padding: 2rem 2rem 1.5rem 2rem; margin-bottom: 2rem;}
      .exam-meta { font-size: 1rem; color: #777; }
      .domain-badge { background: #198754; color: #fff; font-size: 0.95em; border-radius: 8px; margin-right: 8px; padding: 2px 12px; display: inline-block; margin-bottom: 5px;}
      .question-card { border-left: 5px solid #eee; }
      .submit-btn { font-size: 1.15em; padding: 12px 32px; }
      .option-radio, .option-checkbox { margin-bottom: 0.75rem; }
    </style>

    <style>
      #floating-timer {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #212529;
        color: white;
        padding: 10px 14px;
        border-radius: 8px;
        font-size: 18px;
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      }

      #pauseBtn {
        background: none;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
      }

      #pauseBtn:hover {
        color: #ffc107;
      }
    </style>

</head>
<body class="bg-light">

  <div id="floating-timer">
    <span id="countdown">--:--</span>
    <button id="pauseBtn">⏸️</button>
  </div>


  <div class="container py-5">
    <div class="exam-header mb-5 text-center">

      <!-- <div class="exam-meta text-danger fw-bold fs-5" id="timer">
        Time left: <span id="countdown">--:--</span>
        <button id="pauseBtn" class="btn btn-sm btn-outline-secondary ms-3">⏸️ Pause</button>
      </div> -->

      <h1 class="mb-2">{{.TestMetadata.TestName}}</h1>
      {{if .TestMetadata.TestDescription}}
      <div class="lead mb-2">{{.TestMetadata.TestDescription}}</div>
      {{end}}
      <div class="exam-meta mb-2">
        <span class="badge bg-secondary">
          Minimum passing: <b>{{printf "%.2f" .TestMetadata.PassingPercentage}}%</b>
        </span>
      </div>
      <div class="exam-meta mb-3">
        Domains:
        {{range $i, $d := .TestMetadata.ExamDomains}}
          <span class="domain-badge">{{$d}}</span>
        {{end}}
      </div>
      <div class="exam-meta">
        Author: <b>{{.TestMetadata.TestAuthor}}</b> |
        Version: <b>{{.TestMetadata.TestVersion}}</b> |
        Date: <b>{{.TestMetadata.TestDate}}</b> |
        Duration: <b>{{.TestMetadata.TestDuration}} min</b>
      </div>
      <hr style="margin: 1.5rem 0;">
      <p class="exam-meta">
        Answer all questions. Once submitted, you'll see your score, explanations, and can download a PDF report.
      </p>
    </div>

    <form method="POST" action="/submit">
      {{range $index, $q := .Questions}}
        <div class="card question-card mb-4">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <span class="text-primary fw-bold">Q{{add1 $index}}</span>:
              {{$q.Question}}
            </h5>
            {{if eq $q.Type "Single"}}
              <!-- Single choice: radio buttons -->
              {{range $optKey, $optVal := $q.Options}}
                <div class="form-check option-radio">
                  <input class="form-check-input" type="radio" name="q{{$index}}" id="q{{$index}}_{{$optKey}}" value="{{$optKey}}" required>
                  <label class="form-check-label" for="q{{$index}}_{{$optKey}}">
                    <b>{{$optKey}}.</b> {{$optVal}}
                  </label>
                </div>
              {{end}}
            {{else if eq $q.Type "Multiple"}}
              <!-- Multiple choice: checkboxes -->
              {{range $optKey, $optVal := $q.Options}}
                <div class="form-check option-checkbox">
                  <input class="form-check-input" type="checkbox" name="q{{$index}}[]" id="q{{$index}}_{{$optKey}}" value="{{$optKey}}">
                  <label class="form-check-label" for="q{{$index}}_{{$optKey}}">
                    <b>{{$optKey}}.</b> {{$optVal}}
                  </label>
                </div>
              {{end}}
            {{else if or (eq $q.Type "True") (eq $q.Type "False")}}
              <!-- True/False: always True/False radios -->
              <div class="form-check option-radio">
                <input class="form-check-input" type="radio" name="q{{$index}}" id="q{{$index}}_true" value="True" required>
                <label class="form-check-label" for="q{{$index}}_true">True</label>
              </div>
              <div class="form-check option-radio">
                <input class="form-check-input" type="radio" name="q{{$index}}" id="q{{$index}}_false" value="False" required>
                <label class="form-check-label" for="q{{$index}}_false">False</label>
              </div>
            {{end}}
          </div>
        </div>
      {{end}}
      <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary submit-btn shadow">Submit Answers</button>
      </div>
    </form>
  </div>

 <script>
  const durationMinutes = {{.TestMetadata.TestDuration}};
  let timeLeft = durationMinutes * 60;
  const countdownEl = document.getElementById("countdown");
  const pauseBtn = document.getElementById("pauseBtn");
  const submitBtn = document.querySelector("button[type='submit']");

  let timerInterval = null;
  let isPaused = false;

  function updateTimer() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    countdownEl.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      countdownEl.textContent = "Time Out!";
      pauseBtn.disabled = true;
      submitBtn.disabled = true;
      submitBtn.textContent = "Time Out! Submitting...";
      document.querySelector("form").submit();
    }
    timeLeft--;
  }

  function startTimer() {
    timerInterval = setInterval(updateTimer, 1000);
  }

  function pauseTimer() {
    clearInterval(timerInterval);
  }

  pauseBtn.addEventListener("click", () => {
    if (isPaused) {
      startTimer();
      pauseBtn.textContent = "⏸️";
    } else {
      pauseTimer();
      pauseBtn.textContent = "▶️";
    }
    isPaused = !isPaused;
  });

  updateTimer();
  startTimer();
</script>



</body>
</html>
